@page "/receipts"

@using SolforbTestTask.Client.Services
@using SolforbTestTask.Client.Extensions
@using DataContracts

<PageTitle>Поступления</PageTitle>

<RadzenStack Gap="1rem">
     <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
        <RadzenDatePicker @bind-Value=@fromDate />
        <RadzenDatePicker @bind-Value=@toDate />
    </RadzenStack> 

    <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
        <RadzenButton Text="Добавить" Icon="add" Click="@CreateReceiptDocumentDialogBox" />
        <RadzenButton Text="Применить" Icon="refresh" Click="@(_ => grid.Reload())" MouseEnter="@(args => ShowTooltip(args, "Обновить данные"))" />
        <RadzenButton Text="Сбросить фильтры" Disabled="@IsResetFiltersDisabled()" Icon="filter_alt_off" Click="@ResetFilters" MouseEnter="@(args => ShowTooltip(args, "Cбросить фильтры"))" />
    </RadzenStack>

    <LocalizedDataGrid @ref=@grid
                       Style="width:80%"
                       Data="@receipts" Count="@count" TItem="ReceiptDocumentItemDto" LoadData="@LoadData"
                       ColumnWidth="140px"
                       Render="@OnRender"
                       PagerAlwaysVisible="true"
                       LogicalFilterOperator="LogicalFilterOperator.And"
                       IsLoading="@isLoading"
                       AllowMultiColumnSorting="false"
                       PageSizeOptions="@pageSizeOptions"
                       ShowPagingSummary="true"
                       AllowFiltering="false" AllowSorting="false" AllowColumnResize="true"
                       AllowGrouping="false"
                       AllowColumnPicking="false"
                       AllowColumnReorder="false"
                       FilterMode="FilterMode.Advanced"
                       RowDoubleClick="OnRowDoubleClick"
                       FilterPopupRenderMode="PopupRenderMode.OnDemand" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                       AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Center" PageSize="@pageSize">
        <PagingSummaryTemplate>
            Страница @context.CurrentPage из @context.NumberOfPages <b>(Всего @context.TotalCount записей)</b>
        </PagingSummaryTemplate>
        <GroupHeaderTemplate >
            <div @ondblclick="@(async() => await OnGroupDoubleClick(context))">
                <b>Номер: @GetDocumentNumber(context) &nbsp;&nbsp;&nbsp;&nbsp;<br /> Дата: @GetDocumentDate(context)</b>
            </div>            
        </GroupHeaderTemplate>
        <Columns>
            @* <RadzenDataGridColumn TItem="ReceiptDocumentItemDto" Property="Number" Title="Номер" FilterMode="FilterMode.CheckBoxList" />
            <RadzenDataGridColumn TItem="ReceiptDocumentItemDto" Property="Date" Title="Дата" /> *@
            <RadzenDataGridColumn TItem="ReceiptDocumentItemDto" Property="ReceptItem.Resource.Name" Title="Ресурс" />
            <RadzenDataGridColumn TItem="ReceiptDocumentItemDto" Property="ReceptItem.Measurement.Name" Title="Единица измерения" />
            <RadzenDataGridColumn TItem="ReceiptDocumentItemDto" Property="ReceptItem.Count" Title="Количество" />
        </Columns>
    </LocalizedDataGrid>
</RadzenStack>
